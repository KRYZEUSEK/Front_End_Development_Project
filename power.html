<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Power Scaling</title>
<link rel="stylesheet" href="style.css">
<script src="lan.js" defer></script>
<script src="script.js" defer></script>
<script src="powerscaling_script.js" defer></script>
</head>
<body>

<!-- LANG + MODE SWITCHER -->
<div class="top-controls">
  <div class="language-switcher">
    <button onclick="setLanguage('en')">EN</button>
    <button onclick="setLanguage('pl')">PL</button>
  </div>

  <div class="mode-switcher">
    <button onclick="setMode('light')">ğŸŒ</button>
    <button onclick="setMode('rain')">ğŸŒ§ï¸</button>
    <button onclick="setMode('dark')">ğŸŒ‘</button>
    <button onclick="setMode('colorblind')">ğŸ‘ï¸</button>
    <button id="winter-btn" onclick="setMode('winter')" style="display:none;">â„ï¸</button>
  </div>
</div>

<header>
<nav>
  <a href="index.html" data-i18n="home">Home</a>
  <a href="character.html" data-i18n="Chara">Character Creator</a>
  <a href="leveling.html" data-i18n="Leveling">Leveling</a>
  <a href="name.html" data-i18n="NameGen">Name Generator</a>
  <a href="power.html" data-i18n="PowerScaling">Power Scaling</a>
</nav>
</header>

<div class="container">
  <h1 data-i18n="PowerScaling">Power Scaling</h1>
  <p data-i18n="PowerScalingDescriptionLong">
    Compare two characters and estimate which one would most likely win.
  </p>

  <!-- MAIN COMPARISON LAYOUT -->
  <div style="display:flex; justify-content:space-between; gap:30px; margin-top:40px; align-items:flex-start;">

    <!-- LEFT CHARACTER -->
    <div style="flex:1; text-align:center;">
      <h2>Character A</h2>
      <button onclick="loadCharacter('A')">Load saved â†’ Character A</button>
      <br><br>
      <input type="file" id="fileA" accept=".json" onchange="loadFromFile(event, 'A')" class="file-input">
      <label for="fileA" class="file-button">Import saved â†’ Character A</label>
      <pre id="charA-preview" style="margin-top:15px; text-align:left;"></pre>
    </div>

    <!-- CENTER ACTION -->
    <div style="flex:0.6; text-align:center;">
      <button id="compare-btn" style="font-size:1.2em; padding:15px 30px; margin-top:20px;">
        âš”ï¸ Compare
      </button>

      <!-- JEDEN PASEK Z PROCENTAMI PO OBU STRONACH -->
      <div id="comparison-result" style="margin-top:20px; display:block;">
        <div>
          <strong id="winner">Winner:</strong>
        </div>
        <div style="margin-top:10px;">
          <div style="background:#ccc; height:20px; border-radius:10px; position:relative; overflow:hidden;">
            <div
              id="chanceBar"
              style="width:50%; height:100%; transition:width 0.4s;"
            ></div>
            <span id="chanceA-label" style="position:absolute; left:5px; top:0; height:100%; line-height:20px; color:#000; font-weight:bold;">50%</span>
            <span id="chanceB-label" style="position:absolute; right:5px; top:0; height:100%; line-height:20px; color:#000; font-weight:bold;">50%</span>
          </div>
          <div id="chanceText" style="margin-top:8px; white-space:pre-line;"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT CHARACTER -->
    <div style="flex:1; text-align:center;">
      <h2>Character B</h2>
      <button onclick="loadCharacter('B')">Load saved â†’ Character B</button>
      <br><br>
      <input type="file" id="fileB" accept=".json" onchange="loadFromFile(event, 'B')" class="file-input">
      <label for="fileB" class="file-button">Import saved â†’ Character B</label>
      <pre id="charB-preview" style="margin-top:15px; text-align:left;"></pre>
    </div>

  </div>
</div>

<script>
let characterA = null;
let characterB = null;

/* -----------------------------
   ADAPT CHARACTER JSON
------------------------------ */
window.adaptCharacter = function(raw, fallbackName) {
  return {
    name: raw.firstName || fallbackName,
    className: raw.className || raw.class || "Fighter",
    level: Number(raw.level) || 1,
    stats: {
      STR: raw.stats?.str ?? 10,
      DEX: raw.stats?.dex ?? 10,
      CON: raw.stats?.con ?? 10,
      INT: raw.stats?.int ?? 10,
      WIS: raw.stats?.wis ?? 10,
      CHA: raw.stats?.cha ?? 10
    }
  };
}

/* -----------------------------
   LOAD CHARACTER FROM LOCAL STORAGE
------------------------------ */
window.loadCharacter = function(side) {
  const c = JSON.parse(localStorage.getItem('cg_chara') || 'null');
  if (!c) { alert('No saved character'); return; }
  assignCharacter(side, c);
}

/* -----------------------------
   LOAD CHARACTER FROM FILE
------------------------------ */
window.loadFromFile = function(event, side) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const data = JSON.parse(reader.result);
    assignCharacter(side, data);
  };
  reader.readAsText(file);
}

/* -----------------------------
   ASSIGN CHARACTER
------------------------------ */
function assignCharacter(side, rawData) {
  const adapted = adaptCharacter(rawData, side === 'A' ? 'Character A' : 'Character B');
  if (side === 'A') {
    characterA = adapted;
    document.getElementById('charA-preview').textContent = JSON.stringify(adapted, null, 2);
    localStorage.setItem('characterA', JSON.stringify(adapted));
  } else {
    characterB = adapted;
    document.getElementById('charB-preview').textContent = JSON.stringify(adapted, null, 2);
    localStorage.setItem('characterB', JSON.stringify(adapted));
  }
}

/* -----------------------------
   COMPARE BUTTON
------------------------------ */
document.addEventListener("DOMContentLoaded", function() {
  const compareBtn = document.getElementById("compare-btn");
  if (!compareBtn) return;

  compareBtn.addEventListener("click", function() {
    if (!window.compareCharacters) {
      console.error("compareCharacters not loaded");
      alert("PowerScaling script not loaded yet!");
      return;
    }

    if (!characterA || !characterB) {
      alert("Load both characters first!");
      return;
    }

    const result = window.compareCharacters(characterA, characterB);

    const chanceA = result.probabilities[characterA.name];
    const chanceB = result.probabilities[characterB.name];

    // ZwyciÄ™zca
    document.getElementById("winner").innerText = "Winner: " + result.winner;

    // Pasek z kolorem zaleÅ¼nym od przewagi
    const bar = document.getElementById("chanceBar");
    bar.style.width = chanceA + "%";
    if (chanceA > 55) {
      bar.style.background = "#4caf50"; // A prowadzi = zielony
    } else if (chanceB > 55) {
      bar.style.background = "#f44336"; // B prowadzi = czerwony
    } else {
      bar.style.background = "#ffeb3b"; // remis ~50% = Å¼Ã³Å‚ty
    }

    // Procenty po bokach
    document.getElementById("chanceA-label").innerText = chanceA + "%";
    document.getElementById("chanceB-label").innerText = chanceB + "%";

    // Rozpiska pod paskiem
    document.getElementById("chanceText").innerText =
      `${characterA.name}: ${chanceA}%\n${characterB.name}: ${chanceB}%`;
  });
});
</script>

</body>
</html>

